# Система заявок на ремонт техники

Система для управления заявками на ремонт техники в школе с использованием FastAPI.

## Функциональность

Система поддерживает три роли пользователей:

1. **Администратор**:
   - Управление пользователями (создание, редактирование, деактивация)
   - Доступ ко всем заявкам
   - Настройка профилей агентов
   
2. **Агент**:
   - Обработка заявок (изменение статуса, добавление комментариев)
   - Просмотр назначенных ему заявок
   
3. **Пользователь**:
   - Создание новых заявок
   - Просмотр своих заявок и их статусов
   - Чтение комментариев от агентов

## Установка и запуск

### Предварительные требования

- Python 3.7+
- pip (менеджер пакетов Python)
- Virtual Environment (опционально, но рекомендуется)

### Шаги по установке

1. Клонируйте репозиторий:
   ```
   git clone <url-репозитория>
   ```

2. Создайте и активируйте виртуальное окружение:
   ```
   python -m venv venv
   .\venv\Scripts\activate  # для Windows
   source venv/bin/activate  # для Linux/Mac
   ```

3. Установите зависимости:
   ```
   pip install -r requirements.txt
   ```

4. Настройте переменные окружения (или используйте файл .env):
   ```
   # .env
   SECRET_KEY=your-secret-key
   DATABASE_URL=sqlite:///./ticket_system.db
   ```

5. Инициализируйте базу данных:
   ```
   python init_database.py
   ```

6. Запустите приложение:
   ```
   python run.py
   ```

Приложение будет доступно по адресу: `http://localhost:8000`

API документация доступна по адресу: `http://localhost:8000/docs`

### Запуск с использованием Docker

Для запуска приложения в Docker:

1. Убедитесь, что у вас установлены Docker и Docker Compose

2. Создайте директорию для данных:
   ```
   mkdir -p data
   ```

3. Запустите контейнеры:
   ```
   docker-compose up -d
   ```

4. Для остановки контейнеров:
   ```
   docker-compose down
   ```

Приложение будет доступно по адресу: `http://localhost:8000`

## API Endpoints

### Аутентификация
- `POST /api/v1/token` - Получение токена доступа

### Пользователи
- `GET /api/v1/users/` - Список всех пользователей (только администратор)
- `POST /api/v1/users/` - Создание пользователя (только администратор)
- `GET /api/v1/users/me/` - Информация о текущем пользователе
- `GET /api/v1/users/{user_id}` - Информация о пользователе
- `PUT /api/v1/users/{user_id}` - Обновление пользователя
- `DELETE /api/v1/users/{user_id}` - Деактивация пользователя (только администратор)

### Заявки
- `GET /api/v1/tickets/` - Список заявок (с фильтрацией по роли)
- `POST /api/v1/tickets/` - Создание заявки
- `GET /api/v1/tickets/{ticket_id}` - Просмотр заявки
- `PUT /api/v1/tickets/{ticket_id}` - Обновление заявки
- `PUT /api/v1/tickets/{ticket_id}/assign/{agent_id}` - Назначение заявки агенту
- `PUT /api/v1/tickets/{ticket_id}/status/{status}` - Изменение статуса заявки

### Комментарии
- `GET /api/v1/tickets/{ticket_id}/comments/` - Список комментариев к заявке
- `POST /api/v1/tickets/{ticket_id}/comments/` - Добавление комментария к заявке
- `GET /api/v1/comments/{ticket_id}` - Получение комментариев заявки
- `POST /api/v1/comments/{ticket_id}` - Создание комментария к заявке
- `DELETE /api/v1/comments/{comment_id}` - Удаление комментария

## Учетные данные по умолчанию

После инициализации базы данных создается первый администратор:

- Username: `admin`
- Password: `admin`

Используйте эти данные для первого входа, а затем измените пароль через API. 